# 项目优化待办事项

## 📋 概述
本文档列出了项目的优化点，包括目录调整、配置优化、代码清理等方面。

---

## 🗂️ 目录结构优化

### 1. 清理冗余目录
**优先级：高**

- [x] **删除根目录下的 `ui/` 目录**
  - 原因：实际 UI 代码在 `internal/ui/`，根目录的 `ui/index.html` 是遗留的 Web 界面文件，项目已使用 Fyne GUI
  - 影响：减少混淆，明确项目结构
  - 操作：删除 `/ui/` 目录 ✅

- [x] **处理 `.trae/` 目录**
  - 原因：可能是工具生成的临时目录
  - 操作：添加到 `.gitignore` ✅
---

## ⚙️ 配置管理优化

### 2. 清理配置文件
**优先级：高**

- [x] **统一配置文件位置**
  - 问题：`cmd/gui/config.json` 和根目录 `config.json` 重复
  - 方案1：删除 `cmd/gui/config.json`，统一使用根目录配置 ✅

### 3. 清理配置字段
**优先级：高**

GUI 应用中以下配置字段已不再使用，应从 `Config` 结构体中移除：

- [x] **移除 `ProxyAddr`**
  - 原因：GUI 使用数据库存储服务器信息，不再使用单一代理地址配置
  - 影响：简化配置结构 ✅

- [x] **移除 `Username` 和 `Password`**
  - 原因：认证信息存储在服务器的配置中，不再需要全局认证配置
  - 影响：简化配置结构 ✅

- [x] **移除 `ForwardRules`**
  - 原因：GUI 应用专注于自动代理模式，不再使用转发规则
  - 影响：简化配置结构 ✅
  - 注意：`cmd/client` 是测试工具，编译失败是预期的

- [x] **移除 `SubscriptionURL`**
  - 原因：订阅信息存储在数据库中，支持多个订阅
  - 影响：简化配置结构 ✅

- [x] **移除 `ServerListSplitOffset`**
  - 原因：布局配置已迁移到数据库（`LayoutConfig`）
  - 影响：避免配置重复 ✅

### 4. 实现或移除未实现功能
**优先级：中**

- [x] **处理 `AutoSetSystemProxy` 字段**
  - 问题：配置中定义了该字段，但未实现功能
  - 方案1：实现系统代理自动配置功能（跨平台）
  - 方案2：从配置中移除该字段
  - 使用：方案2（如果短期内不实现） ✅

---

## 🧹 代码清理

### 5. 删除废弃代码
**优先级：中**

- [x] **删除 `internal/ui/mainwindow.go` 中的废弃方法**
  - 方法：`createServerManagementTab()`
  - 原因：已废弃，不再使用
  - 位置：第 154-157 行 ✅

### 6. 处理示例代码
**优先级：低**

- [x] **处理 `internal/database/example.go`**
  - 问题：示例代码文件，不应在正式代码中
  - 方案1：将内容移到 README.md 的数据库使用部分
  - 方案2：创建独立的文档文件 `docs/database_usage.md`
  - 方案3：删除文件（如果 README 已有足够说明）
  - 使用：方案3（保持 README 简洁） ✅

---

## 📝 代码质量优化

### 7. 代码注释优化
**优先级：中**

- [x] **为所有导出的函数和类型添加 Go 文档注释**
  - 格式：使用 `// FunctionName 描述...` 格式 ✅
  - 范围：所有 `internal/` 包中的导出函数和类型 ✅
  - 重点：`internal/ui/`、`internal/config/`、`internal/database/` ✅

### 8. 统一错误处理
**优先级：中**

- [x] **检查并统一错误处理模式**
  - 确保所有错误都有适当的日志记录 ✅
  - 确保用户可见的错误有友好的提示 ✅
  - 检查错误包装（使用 `fmt.Errorf` 和 `%w`） ✅
  - 添加统一的错误处理辅助方法（`showError`、`logAndShowError`） ✅

---

## 🔧 配置验证优化

### 9. 简化配置验证
**优先级：低**

- [x] **更新 `Config.Validate()` 方法**
  - 移除对已废弃字段的验证
  - 只验证 GUI 应用实际使用的字段
  - 保持验证逻辑清晰简洁 ✅

---

## 🗄️ 数据库配置迁移

### 10. 配置存储策略优化
**优先级：低**

- [x] **考虑将更多配置迁移到数据库**
  - 当前：布局配置已存储在数据库 ✅
  - 可迁移：日志级别、日志文件路径、主题设置等 ✅
  - 优势：统一配置管理，减少对 JSON 配置文件的依赖 ✅
  - 全部迁移 ✅
  - 实现：添加 `SetAppConfig`/`GetAppConfig` 函数，修改启动逻辑从数据库加载配置，保持向后兼容（从 JSON 迁移）

---

## 📊 优先级总结

### 高优先级（立即处理）
1. 清理冗余目录（`ui/`）
2. 统一配置文件位置
3. 清理未使用的配置字段

### 中优先级（近期处理）
4. 处理 `AutoSetSystemProxy` 字段
5. 删除废弃代码
6. 代码注释优化
7. 统一错误处理

### 低优先级（长期优化）
8. 处理示例代码
9. 简化配置验证
10. 数据库配置迁移

---

## 📌 注意事项

1. **向后兼容性**：删除配置字段前，确保不影响现有配置文件
2. **测试覆盖**：每次修改后运行完整测试
3. **文档更新**：修改配置结构后更新 README.md
4. **命令行工具**：确认 `cmd/client` 等工具是否需要保留某些配置字段

---

## 🔄 执行建议

1. **第一阶段**：清理目录和配置文件（高优先级）
2. **第二阶段**：代码清理和注释优化（中优先级）
3. **第三阶段**：配置迁移和长期优化（低优先级）

---

*最后更新：2024-12-08*
